The clock speed of I2C describes the frequency of the clock line. The speed grades for I2C communication are specified as follows: up to 100 kbit/s (Standard-mode), up to 400 kbit/s (Fast-mode), 1 mbit/s (Fast-mode Plus) and up to 3.4 mbit/s (High-speed mode). By default, the Gumstix i2c-3 port is set to have a speed of 400 kbit/s.

Note that for this project it may be possible to use an I2C speed higher than 100 kbit/s. However, one would have to ensure that all I2C devices can perform at this speed. If the speed is too high, the data line may not be able to change quickly enough to characterize the signal. If the I2C speed must be increased, the next step would be to investigate using a pullup resistor. And to be thorough, examination of the performance of the I2C lines at a higher speed should be done with an oscilloscope.

To change the speed of the i2c-3 port on the Gumstix to 100 kbit/s, you will first need a "base" computer running Linux to connect to the Gumstix. Leave the Gumstix unpowered. Using a USB to USB mini connector, connect the USB to the base computer you are using. Connect the USB mini end to the Gumstix. Note there are three mini USB ports on the Summit expansion board: a USB Host, USB On-the-Go (OTG) and USB console. The connector should be connected to the USB console port which is next to the reset button on the side of the Gumstix with the 40-pin header. Accessing this port will require unscrewing the screws and standoffs that secure the Gumstix and power board. Upon connecting to the Gumstix, check which tty port the device is connected to using the command:

dmesg | grep tty

The last line should indicate where the Gumstix is connected and will look something like this:

[ 9663.137059] usb 7-1: FTDI USB Serial Device converter now attached to ttyUSB0

From the output above, we have determined that the Gumstix is connected to /dev/ttyUSB0. Next we use the screen command to start a serial connection with the Gumstix (if screen is not installed, install it using "sudo apt-get install screen"). Since we determined that our USB device was at /dev/ttyUSB0, we use the following command:

sudo screen /dev/ttyUSB0 115200

If the USB device was not at /dev/ttyUSB0, modify the command above accordingly. The number 115200 in the command above represents the baud. Now the Gumstix can be powered on. You will enter U-Boot and there will be a countdown. There will be a prompt "Hit any key to stop autoboot...". Hit any key to enter U-Boot command shell. Note that the U-Boot command shell is finicky so be careful when typing commands. The next step is change the "i2cspeed" environment variable. To set I2C bus 3 to 100 kHz, enter the command

setenv i2cspeed 3,100

Now use the command

printenv mmcargs

which will tell us what the enivornment variable "mmcargs" is set to. The output of this function will be similar to: 

mmcargs=setenv bootargs console=${console} mpurate=${mpurate} vram=${vram} omapfb.mode=dvi:${dvimode} omapdss.def_disp=${defaultdisplay} root=${mmcroot} rootfstype=${mmcrootfstype}

We want to add the i2cspeed to this definition of mmcargs, so we will set mmcargs using the "@@setenv@@" command. We will set it to its previous definition along with the additional parameter "i2c_bus=${i2cspeed}", which will be inserted after the console setting. So, with the example output above, the example command to set mmcargs would be:

setenv mmcargs setenv bootargs console=${console} i2c_bus=${i2cspeed} mpurate=${mpurate} vram=${vram} omapfb.mode=dvi:${dvimode} omapdss.def_disp=${defaultdisplay} root=${mmcroot} rootfstype=${mmcrootfstype}

Since the command above was based on the output of an example, you should make sure it is in accordance with the output of your "printenv mmcargs".Finally, save the environment variables using

saveenv

Now, the Gumstix can be exited out of U-Boot mode using the command:

boot

For more information on connecting the Gumstix over serial, see "Establishing the Serial Connection" section at http://gumstix.org/connect-to-my-gumstix-system.html. This page also contains commands to clear the U-Boot NAND environment variables, in case you think you may have messed something up in U-Boot.

